

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sadit.Detector.Data &mdash; SADIT 1.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="SADIT 1.1.0 documentation" href="../../../index.html" />
    <link rel="up" title="sadit" href="../../sadit.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SADIT 1.1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sadit.html" accesskey="U">sadit</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sadit.Detector.Data</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">abstract_method</span>
<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">Find</span><span class="p">,</span> <span class="n">DataEndException</span>
<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;abstract base class for data. Data class deals with any implementation</span>
<span class="sd">    details of the data. it can be a file, a sql data base, and so on, as long</span>
<span class="sd">    as it support the pure virtual methods defined here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Data.get_fea_slice"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.Data.get_fea_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_fea_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get a slice of feature</span>
<span class="sd">        - **rg** is the range for the slice</span>
<span class="sd">        - **rg_type** is the type for range, it can be [&#39;flow&#39;|&#39;time&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abstract_method</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Data.get_max"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.Data.get_max">[docs]</a>    <span class="k">def</span> <span class="nf">get_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the max value of feature during a range</span>
<span class="sd">        - **fea** is a list of feature name</span>
<span class="sd">        - **rg** is the range</span>
<span class="sd">        - **rg_type** is the range type</span>
<span class="sd">        the output is the a list of element which contains the max</span>
<span class="sd">        value of the feature in **fea**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abstract_method</span><span class="p">()</span></div>
<div class="viewcode-block" id="Data.get_min"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.Data.get_min">[docs]</a>    <span class="k">def</span> <span class="nf">get_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get min value of feature within a range. see **get_max** for</span>
<span class="sd">        the meaning of the parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abstract_method</span><span class="p">()</span>

<span class="c">##############################################################</span>
<span class="c">####     For Hard Disk File Generated by fs-simulator   ######</span>
<span class="c">##############################################################</span></div></div>
<span class="kn">from</span> <span class="nn">DataParser</span> <span class="kn">import</span> <span class="n">RawParseData</span>
<div class="viewcode-block" id="PreloadHardDiskFile"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile">[docs]</a><span class="k">class</span> <span class="nc">PreloadHardDiskFile</span><span class="p">(</span><span class="n">Data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; for hard Disk File Generated by fs-simulator&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; data_order can be flow_first | feature_first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_name</span> <span class="o">=</span> <span class="n">f_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span> <span class="o">=</span> <span class="n">RawParseData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_name</span><span class="p">)</span>
        <span class="c"># import pdb;pdb.set_trace()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_list</span><span class="p">(</span><span class="s">&#39;start_time&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_fea_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_value_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get a value list for a single key&quot;&quot;&quot;</span>
        <span class="c"># fidx = self.fea_name.index(key)</span>
        <span class="n">fidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fea_idx</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="k">else</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span><span class="p">[</span><span class="n">fidx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get the absolute position of flows records that within the range.</span>
<span class="sd">        some times this function is called by outside function thus break</span>
<span class="sd">        the interoperability&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rg</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">rg_type</span> <span class="o">==</span> <span class="s">&#39;flow&#39;</span><span class="p">:</span>
            <span class="n">sp</span><span class="p">,</span> <span class="n">ep</span> <span class="o">=</span> <span class="n">rg</span>
            <span class="k">if</span> <span class="n">sp</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span><span class="p">:</span> <span class="k">raise</span> <span class="n">DataEndException</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">rg_type</span> <span class="o">==</span> <span class="s">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">min_time</span><span class="p">)</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">min_time</span><span class="p">)</span>
            <span class="c"># if rg[1] + self.min_time &gt; self.max_time :</span>
                <span class="c"># import pdb;pdb.set_trace()</span>
                <span class="c"># raise Exception(&#39;Probably you set wrong range for normal flows? Go to check DETECTOR_DESC&#39;)</span>

            <span class="k">assert</span><span class="p">(</span><span class="n">sp</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">ep</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sp</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ep</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c"># import pdb;pdb.set_trace()</span>
                <span class="k">raise</span> <span class="n">DataEndException</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknow window type&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sp</span><span class="p">,</span> <span class="n">ep</span>


<div class="viewcode-block" id="PreloadHardDiskFile.get_fea_slice"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile.get_fea_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_fea_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="s">&#39;flow_first&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;this function is to get a chunk of feature vector.</span>
<span class="sd">        The feature belongs flows within the range specified by **rg**</span>
<span class="sd">        **rg_type** can be [&#39;flow&#39; | &#39;time&#39; ].</span>
<span class="sd">        data_order can be flow_first | feature_first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sp</span><span class="p">,</span> <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_where</span><span class="p">(</span><span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fea</span><span class="p">:</span>
            <span class="n">fea_idx</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fea</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data_order</span> <span class="o">==</span> <span class="s">&#39;flow_first&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[[</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fea_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">[</span><span class="n">sp</span><span class="p">:</span><span class="n">ep</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">data_order</span> <span class="o">==</span> <span class="s">&#39;feature_first&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value_list</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="n">sp</span><span class="p">:</span><span class="n">ep</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fea</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data_order</span> <span class="o">==</span> <span class="s">&#39;flow_first&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">[</span><span class="n">sp</span><span class="p">:</span><span class="n">ep</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">data_order</span> <span class="o">==</span> <span class="s">&#39;feature_first&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">fv</span><span class="p">[</span><span class="n">sp</span><span class="p">:</span><span class="n">ep</span><span class="p">]</span> <span class="k">for</span> <span class="n">fv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PreloadHardDiskFile.get"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get value list for each feature within the range and return</span>
<span class="sd">        the output of handler function in this value.</span>
<span class="sd">        **handler** is a function handler that take a list as input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fea</span> <span class="o">=</span> <span class="n">fea</span> <span class="k">if</span> <span class="n">fea</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fea_slice</span><span class="p">(</span><span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span>
        <span class="n">zip_sl</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sl</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fea</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">0</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">handler</span><span class="p">(</span> <span class="n">zip_sl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="PreloadHardDiskFile.get_max"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile.get_max">[docs]</a>    <span class="k">def</span> <span class="nf">get_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">max_fea</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">l</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">max_fea</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span>
        <span class="c"># return [max(self._get_value_list(f)[sp:ep]) for f in fea]</span>
        <span class="c"># return [max(float(val) for val in self._get_value_list(f)[sp:ep]) for f in fea]</span>
</div>
<div class="viewcode-block" id="PreloadHardDiskFile.get_min"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile.get_min">[docs]</a>    <span class="k">def</span> <span class="nf">get_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">min_fea</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">l</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">min_fea</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span>
        <span class="c"># sp, ep = self._get_where(rg, rg_type)</span>
        <span class="c"># fea = fea if fea else self.fea_name</span>
        <span class="c"># import pdb;pdb.set_trace()</span>
        <span class="c"># return [min(self._get_value_list(f)[sp:ep]) for f in fea]</span>
        <span class="c"># return [min(float(val) for val in self._get_value_list(f)[sp:ep]) for f in fea]</span>


<span class="c">##############################################################</span>
<span class="c">####  For Hard Disk File Generated by pcap2netflow tool,######</span>
<span class="c">####  for more information about pcap2netflow, please   ######</span>
<span class="c">####  visit https://bitbucket.org/hbhzwj/pcap2netflow   ######</span>
<span class="c">##############################################################</span></div></div>
<span class="kn">import</span> <span class="nn">re</span>
<div class="viewcode-block" id="get_ip_port"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.get_ip_port">[docs]</a><span class="k">def</span> <span class="nf">get_ip_port</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">ip_tmp</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">ip_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span>
</div>
<div class="viewcode-block" id="ParseData_pcap2netflow"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.ParseData_pcap2netflow">[docs]</a><span class="k">def</span> <span class="nf">ParseData_pcap2netflow</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    the input is the filename of the flow file that needs to be parsed.</span>
<span class="sd">    the ouput is list of dictionary contains the information for each flow in the data. all these information are strings, users need</span>
<span class="sd">    to tranform them by themselves</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flow</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># FORMAT = dict(start_time=3, end_time=4, src_ip=5, sc_port=6, octets=13, ) # Defines the FORMAT of the data file</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;FLOW&#39;</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span> <span class="c"># Ignore Blank Line</span>
            <span class="k">continue</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;[ ]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="c">#FIXME need to be changed if want to use port information</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">f</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">src_ip</span><span class="p">,</span> <span class="n">src_port</span> <span class="o">=</span> <span class="n">get_ip_port</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;src&#39;</span><span class="p">])</span>
        <span class="n">dst_ip</span><span class="p">,</span> <span class="n">dst_port</span> <span class="o">=</span> <span class="n">get_ip_port</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;dst&#39;</span><span class="p">])</span>
        <span class="n">f</span><span class="p">[</span><span class="s">&#39;src_ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_ip</span>
        <span class="n">f</span><span class="p">[</span><span class="s">&#39;src_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_port</span>
        <span class="n">f</span><span class="p">[</span><span class="s">&#39;dst_ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dst_ip</span>
        <span class="n">f</span><span class="p">[</span><span class="s">&#39;dst_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dst_port</span>
        <span class="n">f</span><span class="p">[</span><span class="s">&#39;flow_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;octets&#39;</span><span class="p">]</span>

        <span class="n">flow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">flow</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Not even a flow is found. Are you specifying the right filename?&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">flow</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PreloadHardDiskFile_pcap2netflow"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile_pcap2netflow">[docs]</a><span class="k">class</span> <span class="nc">PreloadHardDiskFile_pcap2netflow</span><span class="p">(</span><span class="n">PreloadHardDiskFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;data with format of pcap2netflow, (softflowd and flowd-reader)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span> <span class="o">=</span> <span class="n">ParseData_pcap2netflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rg_type</span> <span class="o">!=</span> <span class="s">&#39;flow&#39;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">sys</span>
            <span class="k">print</span> <span class="s">&quot;&quot;&quot;[Error]: data of pcap2netflow format can only use flow window,</span>
<span class="s">please change your window type to &#39;flow&#39;&quot;&quot;&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">PreloadHardDiskFile_pcap2netflow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_where</span><span class="p">(</span><span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span>

</div>
<span class="sd">&quot;&quot;&quot; Data File Generated By Flow Exporter tool</span>
<span class="sd">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ParseFlowExporterData"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.ParseFlowExporterData">[docs]</a><span class="k">def</span> <span class="nf">ParseFlowExporterData</span><span class="p">(</span><span class="n">f_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parse the data format generated by FlowExporter.py tool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># raw = lambda x:x</span>
    <span class="c"># dotted_int = lambda x: tuple(int(v) for v in x.rsplit(&#39;.&#39;))</span>
    <span class="k">def</span> <span class="nf">ip_str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BROADCAST&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;255.255.255.255&#39;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span> <span class="c"># not ip v4</span>
            <span class="k">return</span> <span class="s">&#39;0.0.0.0&#39;</span> <span class="c"># return an arbitracy address</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

    <span class="n">FORMAT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
            <span class="n">src_ip</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">),</span>
            <span class="n">dst_ip</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">),</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
            <span class="n">flow_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
            <span class="n">flow_dur</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
            <span class="p">)</span>


    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_name</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">record</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tline</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tline</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">tline</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span> <span class="c"># Ignore Blank Line</span>
            <span class="k">continue</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">tline</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmter</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fmter</span><span class="p">)</span> <span class="ow">in</span> <span class="n">FORMAT</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()]</span>
        <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">record</span><span class="p">,</span> <span class="n">FORMAT</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PreloadHardDiskFile_FlowExporter"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile_FlowExporter">[docs]</a><span class="k">class</span> <span class="nc">PreloadHardDiskFile_FlowExporter</span><span class="p">(</span><span class="n">PreloadHardDiskFile</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span> <span class="o">=</span> <span class="n">ParseFlowExporterData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;start_time&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">)</span>


<span class="c">##############################################################</span>
<span class="c">####  For simpleweb.org labled dataset, it is stored in ######</span>
<span class="c">####  mysql server.                                     ######</span>
<span class="c">####  visit http://www.simpleweb.org/wiki/Traces for    ######</span>
<span class="c">####  more information (trace 8)                        ######</span>
<span class="c">##############################################################</span>

<span class="c"># from util import _mysql</span></div>
<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">mysql</span>
<span class="c"># try:</span>
<span class="c">#     import _mysql</span>
<span class="c"># except ImportError as e:</span>
<span class="c">#     print &#39;--&gt; [warning] cannot import sql related function, \</span>
<span class="c">#             reading for sql server is not supported&#39;</span>
    <span class="c"># print &#39;--&gt; e:&#39;, e</span>

<span class="n">get_sec_msec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)]</span>

<div class="viewcode-block" id="SQLFile_SperottoIPOM2009"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.SQLFile_SperottoIPOM2009">[docs]</a><span class="k">class</span> <span class="nc">SQLFile_SperottoIPOM2009</span><span class="p">(</span><span class="n">Data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data File wrapper for SperottoIPOM2009 format. it is store in mysql server, visit</span>
<span class="sd">     http://traces.simpleweb.org/traces/netflow/netflow2/dataset_description.txt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="c"># self.db = _mysql.connect(**spec)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># select minimum time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;&quot;&quot;SELECT start_time, start_msec FROM flows WHERE (id = 1);&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time_tuple</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">min_time_tuple</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;&quot;&quot;SELECT MAX(id) FROM flows;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;&quot;&quot;SELECT end_time, end_msec FROM flows WHERE (id = </span><span class="si">%d</span><span class="s">);&quot;&quot;&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_tuple</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">max_time_tuple</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_sql_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rg_type</span> <span class="o">==</span> <span class="s">&#39;flow&#39;</span><span class="p">:</span>
                <span class="n">SQL_SEN_WHERE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot; WHERE ( (id &gt;= </span><span class="si">%f</span><span class="s">) AND (id &lt; </span><span class="si">%f</span><span class="s">) )&quot;&quot;&quot;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataEndException</span><span class="p">(</span><span class="s">&quot;reach data end&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">rg_type</span> <span class="o">==</span> <span class="s">&#39;time&#39;</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">get_sec_msec</span> <span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span><span class="p">)</span>
                <span class="n">ed</span> <span class="o">=</span> <span class="n">get_sec_msec</span> <span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span><span class="p">)</span>
                <span class="n">SQL_SEN_WHERE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot; WHERE ( (start_time &gt; </span><span class="si">%d</span><span class="s">) OR ( (start_time = </span><span class="si">%d</span><span class="s">) AND (start_msec &gt;= </span><span class="si">%d</span><span class="s">)) ) AND</span>
<span class="s">                             ( (end_time &lt; </span><span class="si">%d</span><span class="s">) OR ( (end_time = </span><span class="si">%d</span><span class="s">) and (end_msec &lt; </span><span class="si">%d</span><span class="s">) ) )&quot;&quot;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ed</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c"># print &#39;rg[0]&#39;, rg[0]</span>
                <span class="c"># print &#39;self.min_time&#39;, self.min_time</span>
                <span class="c"># print &#39;current time, &#39;, rg[0] + self.min_time</span>
                <span class="c"># print &#39;self.maxtime&#39;, self.max_time</span>
                <span class="k">if</span> <span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataEndException</span><span class="p">(</span><span class="s">&quot;reach data end&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;rg_type&#39;</span><span class="p">,</span> <span class="n">rg_type</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknow window type&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SQL_SEN_WHERE</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SQL_SEN_WHERE</span>

<div class="viewcode-block" id="SQLFile_SperottoIPOM2009.get_max"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.SQLFile_SperottoIPOM2009.get_max">[docs]</a>    <span class="k">def</span> <span class="nf">get_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">fea_str</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;MAX(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fea</span><span class="p">]</span>
        <span class="n">SQL_SEN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;SELECT </span><span class="si">%s</span><span class="s"> FROM flows&quot;&quot;&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fea_str</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sql_where</span><span class="p">(</span><span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SQL_SEN</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SQLFile_SperottoIPOM2009.get_min"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.SQLFile_SperottoIPOM2009.get_min">[docs]</a>    <span class="k">def</span> <span class="nf">get_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">fea_str</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;MIN(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fea</span><span class="p">]</span>
        <span class="n">SQL_SEN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;SELECT </span><span class="si">%s</span><span class="s"> FROM flows&quot;&quot;&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fea_str</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sql_where</span><span class="p">(</span><span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SQL_SEN</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SQLFile_SperottoIPOM2009.get_fea_slice"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.SQLFile_SperottoIPOM2009.get_fea_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_fea_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;this function is to get a chunk of feature vector.</span>
<span class="sd">        The feature belongs flows within the range specified by **rg**</span>
<span class="sd">        **rg_type** can be [&#39;flow&#39; | &#39;time&#39; ].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SQL_SEN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;SELECT </span><span class="si">%s</span><span class="s"> FROM flows&quot;&quot;&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fea</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sql_where</span><span class="p">(</span><span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span>
        <span class="c"># print SQL_SEN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SQL_SEN</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># return [line[0] for line in result] if len(fea) == 1 else result</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="c">#######################################################</span>
<span class="c">## Flow Records Generated by xflow tools            ###</span>
<span class="c">#######################################################</span></div></div>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">strptime</span><span class="p">,</span> <span class="n">mktime</span>
<span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="c"># http://stackoverflow.com/questions/3071415/efficient-method-to-calculate-the-rank-vector-of-a-list-in-python</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="n">seq</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">argsort</span>

<div class="viewcode-block" id="PreloadHardDiskFile_xflow"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile_xflow">[docs]</a><span class="k">class</span> <span class="nc">PreloadHardDiskFile_xflow</span><span class="p">(</span><span class="n">PreloadHardDiskFile</span><span class="p">):</span>
    <span class="n">attr_mapping</span> <span class="o">=</span> <span class="p">{</span> <span class="c"># define the synonym</span>
            <span class="s">&#39;src_ip&#39;</span><span class="p">:</span> <span class="s">&#39;client_ip&#39;</span><span class="p">,</span>
            <span class="s">&#39;flow_size&#39;</span><span class="p">:</span> <span class="s">&#39;Cb&#39;</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_xflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fea_vec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_fea_vec</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value_list</span><span class="p">(</span><span class="s">&#39;start_time&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="PreloadHardDiskFile_xflow.get_fea_slice"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile_xflow.get_fea_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_fea_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rg_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="s">&#39;flow_first&#39;</span><span class="p">):</span>
        <span class="n">fea</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fea</span><span class="p">]</span><span class="c"># synonym replacement</span>
        <span class="k">return</span> <span class="n">PreloadHardDiskFile</span><span class="o">.</span><span class="n">get_fea_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fea</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">rg_type</span><span class="p">,</span> <span class="n">data_order</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_fea_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fea_name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PreloadHardDiskFile_xflow.parse_xflow"><a class="viewcode-back" href="../../../generated/sadit.Detector.html#sadit.Detector.Data.PreloadHardDiskFile_xflow.parse_xflow">[docs]</a>    <span class="k">def</span> <span class="nf">parse_xflow</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the input is the filename of the flow file that needs to be parsed.</span>
<span class="sd">        the ouput is list of dictionary contains the information for each flow in the data. all these information are strings, users need</span>
<span class="sd">        to tranform them by themselves</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Defines the FORMAT of the data file</span>
        <span class="n">FORMAT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">FORMAT</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">proto</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">client_ip</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">direction</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">server_ip</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">Cb</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="n">Cp</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">Sb</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
            <span class="n">Sp</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">FORMAT</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">proto</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">client_ip</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">direction</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">server_ip</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="n">Cb</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">Cp</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
            <span class="n">Sb</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">Sp</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">FORMAT</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">proto</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">client_ip</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="c"># client_port=4,</span>
            <span class="n">direction</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">server_ip</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="c"># server_port=7,</span>
            <span class="n">Cb</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
            <span class="n">Cp</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">Sb</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">Sp</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">FORMAT</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">proto</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">client_ip</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="c"># client_port=5,</span>
            <span class="n">direction</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="n">server_ip</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="c"># server_port=8,</span>
            <span class="n">Cb</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">Cp</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">Sb</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">Sp</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c"># dotted_to_int = lambda x: [int(val) for val in x.rsplit(&#39;.&#39;)]</span>
        <span class="n">port_str_to_int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">attr_convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span> <span class="n">x</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mktime</span><span class="p">(</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;%Y%m</span><span class="si">%d</span><span class="s">.%H:%M:%S&#39;</span><span class="p">)),</span>
                <span class="n">proto</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                <span class="c"># client_ip = dotted_to_int,</span>
                <span class="n">client_ip</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                <span class="n">client_port</span><span class="o">=</span><span class="n">port_str_to_int</span><span class="p">,</span>
                <span class="n">direction</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                <span class="c"># server_ip=dotted_to_int,</span>
                <span class="n">server_ip</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span>
                <span class="n">server_port</span><span class="o">=</span><span class="n">port_str_to_int</span><span class="p">,</span>
                <span class="n">Cb</span><span class="o">=</span> <span class="n">attr_convert</span><span class="p">,</span>
                <span class="n">Cp</span><span class="o">=</span> <span class="n">attr_convert</span><span class="p">,</span>
                <span class="n">Sb</span><span class="o">=</span> <span class="n">attr_convert</span><span class="p">,</span>
                <span class="n">Sp</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="p">)</span>
        <span class="n">fea_name</span> <span class="o">=</span> <span class="n">FORMAT</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">handler</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="n">item</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">FORMAT</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unexpected Flow Data Format&#39;</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">fea_name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;start_time&#39;</span><span class="p">)])</span>
            <span class="n">flow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">arg_t</span> <span class="o">=</span> <span class="n">argsort</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">sort_flow</span> <span class="o">=</span> <span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg_t</span> <span class="p">]</span>

        <span class="k">return</span> <span class="n">sort_flow</span><span class="p">,</span> <span class="n">fea_name</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SADIT 1.1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sadit.html" >sadit</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jing Conan Wang.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>